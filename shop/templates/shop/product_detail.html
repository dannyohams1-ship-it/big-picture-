{% extends "shop/base.html" %}
{% load static %}
{% block content %}
{% load static currency_tags %}

<div class="container mt-5">
    <div class="row g-5">

        <!-- =======================
             PRODUCT IMAGES
        ======================== -->
        <div class="col-md-6">
            {% if product.image or product.images.all %}
            <div id="productCarousel" class="carousel slide border rounded-3 shadow-sm overflow-hidden" data-bs-ride="carousel">
                <div class="carousel-inner" style="aspect-ratio:1/1; object-fit:cover;">
                    {% if product.image %}
                    <div class="carousel-item active">
                        <img src="{{ product.image.url }}" class="d-block w-100 h-100" alt="{{ product.name }}" style="object-fit:cover;">
                    </div>
                    {% endif %}

                    {% for img in product.images.all %}
                    <div class="carousel-item {% if not product.image and forloop.first %}active{% endif %}">
                        <img src="{{ img.image.url }}" class="d-block w-100 h-100" alt="{{ product.name }}" style="object-fit:cover;">
                    </div>
                    {% endfor %}
                </div>

                <!-- Carousel controls -->
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>
            {% else %}
            <img src="https://via.placeholder.com/500x500.png?text=No+Image"
                 alt="No Image"
                 class="img-fluid border rounded-3 shadow-sm">
            {% endif %}
        </div>

        <!-- =======================
             PRODUCT INFO
        ======================== -->
        <div class="col-md-6">
            <h2 class="fw-bold mb-2">{{ product.name }}</h2>
            {% load currency %}
            <h4 class="text-warning fw-semibold mb-3">
              {{ product.price|as_currency:request.session.currency }}
            </h4>

            <!-- Stock Status -->
            {% if product.stock > 5 %}
                <p class="text-success fw-semibold">In Stock</p>
            {% elif product.stock > 0 %}
                <p class="text-danger fw-semibold">Only {{ product.stock }} left!</p>
            {% else %}
                <p class="text-muted fw-semibold">Out of Stock</p>
            {% endif %}

            <!-- Product Description -->
            {% if product.description %}
                <p class="text-muted">{{ product.description }}</p>
            {% else %}
                <p class="text-muted">No description available.</p>
            {% endif %}

            <!-- Add to Cart -->
            {% if product.stock > 0 %}
            <form method="post" action="{% url 'add_to_cart' product.id %}" class="d-flex gap-3 align-items-center my-3">
                {% csrf_token %}
                <input type="number"
                       name="quantity"
                       value="1"
                       min="1"
                       max="{{ product.stock }}"
                       class="form-control text-center"
                       style="width:100px;">
                <button type="submit" class="btn btn-dark flex-grow-1 py-2 rounded-pill">
                    ðŸ›’ Add to Cart
                </button>
            </form>
            <small class="text-muted">Available: {{ product.stock }}</small>
            {% else %}
            <button class="btn btn-secondary btn-lg mt-3" disabled>Out of Stock</button>
            {% endif %}

            <!-- Delivery Info -->
            <div class="mt-4">
                <small class="d-block text-muted">
                    ðŸšš Delivery within <strong>Lagos & Port Harcourt</strong>: <strong>1 week</strong>.  
                    Outside regions: via trusted logistics partners.
                </small>
            </div>

            <!-- Social Sharing -->
            <div class="mt-4">
                <h5>Share this product:</h5>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
                   target="_blank" class="btn btn-sm btn-primary me-2">Facebook</a>
                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text=Check this out!"
                   target="_blank" class="btn btn-sm btn-info text-white me-2">Twitter</a>
                <a href="https://wa.me/?text=Check this product: {{ request.build_absolute_uri }}"
                   target="_blank" class="btn btn-sm btn-success">WhatsApp</a>
            </div>
        </div>
    </div>
</div>

<!-- =======================
     EXTRA STYLING
======================= -->
<style>
.carousel-inner img {
    transition: transform .3s ease;
}
.carousel-inner img:hover {
    transform: scale(1.05);
}
.btn-dark {
    background: #000;
    border: none;
}
.btn-dark:hover {
    background: #d4af37;
    color: #000;
}
</style>
{% endblock %}
